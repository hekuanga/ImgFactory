# 方舟SDK网络连接说明

## 问题说明

在测试过程中发现，方舟SDK（api.doubao.com）可能在某些网络环境中无法访问，具体表现为域名解析失败（`getaddrinfo ENOTFOUND api.doubao.com`）。这通常是由于以下原因导致的：

1. 网络防火墙限制
2. DNS服务器无法解析该域名
3. 网络环境的地区限制

## 已实施的解决方案

为了解决这个问题，我们已经做了以下优化：

1. **修改默认模型**：将默认修复模型从方舟SDK更改为Replicate，确保用户在大多数网络环境中都能正常使用照片修复功能
2. **增强错误处理**：添加了更详细的错误信息，当检测到域名解析问题时，会显示明确的提示
3. **自动故障转移**：保留了模型自动切换机制，当首选模型失败时会尝试备用模型

## 技术细节

### 默认模型选择逻辑

```typescript
// 当前实现 - 默认使用Replicate
const selectedModel = requestedModel || 'replicate';
```

### 增强的错误处理

针对网络连接问题，我们添加了更精确的错误检测和提示：

```typescript
if (error.message.includes('ENOTFOUND') || error.message.includes('getaddrinfo')) {
  // 明确标识域名解析问题
  errorMsg = '方舟SDK网络连接失败：无法解析API域名，可能是网络限制或防火墙阻止';
}
```

## 用户指南

- 在大多数情况下，系统会自动选择可用的模型
- 如果您明确需要使用方舟SDK，请确保您的网络环境可以访问 `api.doubao.com`
- 如果遇到网络连接错误，请尝试以下方法：
  1. 检查您的网络连接
  2. 尝试使用不同的网络环境
  3. 选择Replicate模型进行照片修复

## 开发者注意事项

- 在部署前，请检查目标环境是否可以访问所需的API服务
- 如需完全禁用方舟SDK，请在代码中调整模型选择逻辑
- 定期检查API服务的可用性和访问限制